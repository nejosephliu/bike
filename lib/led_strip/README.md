LED Strip
====
Code library for interfacing with the Adafruit Neopixel WS2812B LED strip.

The [WS2812B](https://cdn-shop.adafruit.com/datasheets/WS2812B.pdf) is an LED and control circuit fused together.  It contains 4 pins - Vdd, Vss, DataIn, and DataOut.  The Neopixel simply chains many WS2812Bs together in an easy-to-manipulate strip.

There are many libraries online for controlling the Neopixel strip, such as  [FastLed](https://github.com/FastLED/FastLED) and [Adafruit Neopixel](https://github.com/adafruit/Adafruit_NeoPixel).  Unfortunately, these libraries are tailored more towards Arduino controllers rather than NRF52 controllers such as the one we are using.  Additionally, these libraries are complex to follow, with many using assembly language to get precise cycle timing.  Lastly, both libraries above are written in C++, whereas our project uses C.  Due to these reasons, we decided to write our own simplified library for controlling the Neopixel.  

Armed with the WS2812B spec and Adafruit's [guide](https://learn.adafruit.com/adafruit-neopixel-uberguide/advanced-coding), we learned about the electrical signals required to run the strip.  The WS2812B does not contain a clock pin; instead, it relies on self-clocking and a proper duty cycle to tell between 1s and 0s.  Each cycle takes 1.25 microseconds; a 0 should be held high for 0.4 microseconds, and a 1 should be held high for 0.8 microseconds, with a generous 150 nanoseconds of leeway.  Data should be sent in GRB order, with each color byte transmitted in little-endian format.  The first pixel takes the first 24 bits, the second will take the next 24, and so on.  After all data is sent, the data line must be held low for a while to "lock" in the color.

It turns out the Adafruit Neopixel library contains a section for the NRF52, most likely for its Bluefruit ccontroller.  It uses a simple idea of using a PWM driver to send the data.  The 1.25 microsecond cycle time corresponds to 800 kHz frequency.  The NRF52 SDK supports a maximum of 16 MHz, meaning each cycle should be 20 ticks long.  A 0 should be held for 6 ticks and a 1 should be held for 13.  We drew inspiration from this idea and after countless hours of struggling through the NRF52 [PWM library](https://infocenter.nordicsemi.com/topic/com.nordic.infocenter.sdk5.v15.0.0/lib_pwm.html), we managed to send the proper signal to the LED strip.  As a side note, the Adafruit Neopixel library uses the lower level hardware access level ([HAL](https://infocenter.nordicsemi.com/topic/com.nordic.infocenter.sdk5.v15.3.0/group__nrf__pwm__hal.html)) for its PWM control.

The hardware itself provided many challenges too, even if the final connections were fairly simple.  Adafruit advises to put a capacitance across power and ground (which is standard), and to put a resistor of at least 470 Ohms between the data pin on the microcontroller and the LED strip.  We found out that we also needed to put a small resistor across the 5V power line to the LED strip input.  Another concern was that while the NRF52832 contains a 5V pin, the GPIO pins on the nrf52 are only 3.3V output (in practice it is closer to 2.8).  Using a level shifter would be the best solution, but since we are not controlling too many LEDs, a direct connection turned out fine.
